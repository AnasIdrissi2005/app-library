<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>مكتبة التطبيقات</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    /* الخطوط والألوان */
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
    :root {
      --primary-color: #0d47a1;
      --secondary-color: #1976d2;
      --accent-color: #42a5f5;
      --background-color: #f0f4f8;
      --card-color: #fff;
      --text-color: #333;
      --shadow-color: rgba(13, 71, 161, 0.15);
      --shadow-hover-color: rgba(13, 71, 161, 0.3);
      --font-size-base: 16px;
    }
    body {
      font-family: 'Cairo', Arial, sans-serif;
      background: var(--background-color);
      margin: 0;
      padding: 20px;
      color: var(--text-color);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      font-size: var(--font-size-base);
    }
    h1 {
      font-size: 2.5rem;
      margin-bottom: 30px;
      color: var(--primary-color);
      user-select: none;
      text-align: center;
    }
    
    /* أزرار الوصول السريع */
    .quick-access-buttons {
      position: fixed;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 100;
    }
    .quick-access-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--card-color);
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1.2rem;
      color: var(--primary-color);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }
    .quick-access-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
    }
    
    /* زر تبديل الوضع */
    .theme-toggle {
      position: absolute;
      top: 20px;
      left: 20px;
      background: var(--card-color);
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1.2rem;
      color: var(--primary-color);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      z-index: 100;
    }
    .theme-toggle:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
    }
    
    /* قسم التطبيقات المميزة */
    .featured-section {
      width: 100%;
      max-width: 1200px;
      margin-bottom: 40px;
    }
    .featured-section h2 {
      color: var(--primary-color);
      margin-bottom: 20px;
      text-align: center;
    }
    .featured-container {
      display: flex;
      overflow-x: auto;
      gap: 20px;
      padding-bottom: 15px;
      scrollbar-width: thin;
      scrollbar-color: var(--accent-color) #f1f1f1;
    }
    .featured-container::-webkit-scrollbar {
      height: 8px;
    }
    .featured-container::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    .featured-container::-webkit-scrollbar-thumb {
      background: var(--accent-color);
      border-radius: 10px;
    }
    .featured-app {
      min-width: 280px;
      background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
      color: white;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 8px 20px rgba(13, 71, 161, 0.3);
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }
    .featured-app img {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      padding: 5px;
      margin-bottom: 15px;
    }
    .featured-app .app-name {
      color: white;
      font-size: 1.3rem;
      margin-bottom: 10px;
    }
    .featured-app .app-category {
      color: rgba(255, 255, 255, 0.8);
      margin-bottom: 15px;
    }
    .featured-app .download {
      background: white;
      color: var(--primary-color);
      margin-top: auto;
    }
    
    /* قسم الإحصائيات */
    .stats-section {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
      flex-wrap: wrap;
      width: 100%;
      max-width: 800px;
    }
    .stat-card {
      background: var(--card-color);
      border-radius: 16px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 4px 12px var(--shadow-color);
      flex: 1;
      min-width: 150px;
      transition: transform 0.3s ease;
    }
    .stat-card:hover {
      transform: translateY(-5px);
    }
    .stat-number {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: 5px;
    }
    .stat-label {
      color: var(--text-color);
      font-size: 0.9rem;
    }
    
    /* البحث */
    .search-container {
      width: 100%;
      max-width: 600px;
      margin-bottom: 30px;
      position: relative;
    }
    .search-box {
      width: 100%;
      padding: 15px 50px 15px 20px;
      border: 2px solid var(--accent-color);
      border-radius: 50px;
      font-size: 1rem;
      font-family: 'Cairo', Arial, sans-serif;
      outline: none;
      transition: border-color 0.3s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    .search-box:focus {
      border-color: var(--primary-color);
    }
    .search-icon {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--primary-color);
      font-size: 1.2rem;
    }
    
    /* اقتراحات البحث */
    .search-suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: var(--card-color);
      border-radius: 12px;
      box-shadow: 0 8px 20px var(--shadow-color);
      max-height: 200px;
      overflow-y: auto;
      z-index: 10;
      margin-top: 5px;
      opacity: 0;
      transform: translateY(-10px);
      transition: all 0.3s ease;
      pointer-events: none;
    }
    .search-suggestions.show {
      opacity: 1;
      transform: translateY(0);
      pointer-events: all;
    }
    .suggestion-item {
      padding: 12px 20px;
      cursor: pointer;
      transition: background-color 0.2s ease;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }
    .suggestion-item:last-child {
      border-bottom: none;
    }
    .suggestion-item:hover {
      background-color: rgba(66, 165, 245, 0.1);
    }
    .no-suggestions {
      padding: 12px 20px;
      text-align: center;
      color: #888;
    }
    
    /* التصنيفات */
    .categories {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-bottom: 30px;
      width: 100%;
      max-width: 800px;
    }
    .category {
      padding: 8px 16px;
      background: var(--card-color);
      border-radius: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease;
      font-weight: 600;
      color: var(--primary-color);
    }
    .category:hover, .category.active {
      background: var(--primary-color);
      color: white;
      transform: translateY(-3px);
    }
    
    /* قائمة التطبيقات */
    #app-list {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      width: 100%;
      max-width: 1200px;
    }
    .app-card {
      background: var(--card-color);
      border-radius: 16px;
      box-shadow: 0 8px 20px var(--shadow-color);
      padding: 20px;
      width: 220px;
      text-align: center;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      cursor: default;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }
    .app-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 30px var(--shadow-hover-color);
      cursor: pointer;
    }
    .app-card img {
      width: 120px;
      height: 120px;
      object-fit: contain;
      margin-bottom: 15px;
      border-radius: 12px;
      background: #e3f2fd;
      padding: 10px;
      box-sizing: border-box;
      user-select: none;
    }
    .app-name {
      font-size: 1.2rem;
      font-weight: 700;
      margin-bottom: 10px;
      color: var(--primary-color);
      min-height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .app-category {
      font-size: 0.9rem;
      color: var(--accent-color);
      margin-bottom: 10px;
      font-weight: 600;
    }
    .app-rating {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
      gap: 5px;
    }
    .stars {
      color: #ffc107;
      font-size: 1rem;
    }
    .rating-value {
      color: #666;
      font-size: 0.9rem;
    }
    .favorite-btn, .share-btn {
      position: absolute;
      background: rgba(255, 255, 255, 0.8);
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1.2rem;
      transition: all 0.3s ease;
    }
    .favorite-btn {
      top: 15px;
      left: 15px;
      color: #e91e63;
    }
    .share-btn {
      bottom: 15px;
      left: 15px;
      color: var(--primary-color);
      font-size: 1rem;
    }
    .favorite-btn:hover, .share-btn:hover {
      background: white;
      transform: scale(1.1);
    }
    .favorite-btn.active .favorite-icon {
      color: #e91e63;
    }
    .download {
      background: var(--secondary-color);
      color: white;
      padding: 10px 18px;
      text-decoration: none;
      border-radius: 12px;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(25, 118, 210, 0.4);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      user-select: none;
      margin-top: auto;
    }
    .download:hover,
    .download:focus {
      background: var(--primary-color);
      box-shadow: 0 6px 18px rgba(13, 71, 161, 0.6);
      outline: none;
    }
    
    /* قسم المراجعات */
    .reviews-section {
      margin-top: 15px;
      width: 100%;
    }
    .add-review-btn {
      background: var(--accent-color);
      color: white;
      border: none;
      border-radius: 20px;
      padding: 5px 12px;
      font-size: 0.8rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .add-review-btn:hover {
      background: var(--primary-color);
    }
    .reviews-list {
      margin-top: 10px;
      max-height: 150px;
      overflow-y: auto;
      text-align: right;
    }
    .review-item {
      background: rgba(0, 0, 0, 0.05);
      border-radius: 8px;
      padding: 8px;
      margin-bottom: 8px;
      font-size: 0.8rem;
    }
    .review-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
    }
    .review-author {
      font-weight: 600;
      color: var(--primary-color);
    }
    .review-rating {
      color: #ffc107;
    }
    .review-text {
      color: #555;
    }
    
    /* مؤشر التحميل */
    .loader {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(13, 71, 161, 0.2);
      border-radius: 50%;
      border-top-color: var(--primary-color);
      animation: spin 1s ease-in-out infinite;
      margin: 50px auto;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* رسالة عدم وجود نتائج */
    .no-results {
      text-align: center;
      font-size: 1.2rem;
      color: var(--primary-color);
      margin: 30px 0;
    }
    
    /* الإشعارات */
    .notifications-container {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-width: 90%;
      pointer-events: none;
    }
    .notification {
      background: var(--primary-color);
      color: white;
      padding: 15px 25px;
      border-radius: 50px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      display: flex;
      align-items: center;
      gap: 10px;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.3s ease;
      pointer-events: all;
    }
    .notification.show {
      opacity: 1;
      transform: translateY(0);
    }
    .notification-icon {
      font-size: 1.2rem;
    }
    .notification-close {
      background: none;
      border: none;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
      margin-right: 10px;
    }
    .notification-success {
      background: #388e3c;
    }
    .notification-error {
      background: #d32f2f;
    }
    .notification-warning {
      background: #f57c00;
    }
    
    /* نوافذ الحوار المنبثقة */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }
    .modal-overlay.show {
      opacity: 1;
      pointer-events: all;
    }
    .modal-content {
      background: var(--card-color);
      border-radius: 16px;
      padding: 25px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      transform: scale(0.9);
      transition: transform 0.3s ease;
    }
    .modal-overlay.show .modal-content {
      transform: scale(1);
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .modal-header h3 {
      margin: 0;
      color: var(--primary-color);
    }
    .close-modal {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #888;
    }
    .close-modal:hover {
      color: var(--primary-color);
    }
    
    /* نموذج المراجعة */
    .rating-input {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }
    .star-rating {
      display: flex;
      direction: ltr;
    }
    .star-rating .star {
      font-size: 1.5rem;
      color: #ddd;
      cursor: pointer;
      transition: color 0.2s ease;
    }
    .star-rating .star:hover,
    .star-rating .star.active {
      color: #ffc107;
    }
    .review-form-modal textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-family: 'Cairo', Arial, sans-serif;
      resize: vertical;
      min-height: 100px;
      margin-bottom: 15px;
    }
    .form-buttons {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }
    .form-buttons button {
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Cairo', Arial, sans-serif;
      font-weight: 600;
    }
    .submit-review {
      background: var(--primary-color);
      color: white;
    }
    .cancel-review {
      background: #f1f1f1;
      color: #333;
    }
    
    /* إشعار التحديث */
    .update-notification {
      position: fixed;
      bottom: 20px;
      left: 20px;
      right: 20px;
      background: var(--card-color);
      border-radius: 16px;
      box-shadow: 0 8px 20px var(--shadow-hover-color);
      max-width: 400px;
      margin: 0 auto;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 1000;
    }
    .update-notification.show {
      transform: translateY(0);
      opacity: 1;
    }
    .update-notification-header {
      display: flex;
      align-items: center;
      padding: 15px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }
    .update-icon {
      width: 40px;
      height: 40px;
      background: var(--accent-color);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-left: 15px;
    }
    .update-title {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--primary-color);
    }
    .close-update-notification {
      background: none;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
      color: #888;
      margin-right: auto;
    }
    .update-notification-content {
      padding: 15px;
    }
    .update-app-info {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }
    .update-app-icon {
      width: 50px;
      height: 50px;
      border-radius: 12px;
      margin-left: 15px;
    }
    .update-app-details {
      text-align: right;
    }
    .update-app-name {
      font-weight: 700;
      margin-bottom: 5px;
    }
    .update-app-version {
      color: #888;
      font-size: 0.9rem;
    }
    .update-changes {
      margin-bottom: 15px;
    }
    .update-changes h4 {
      margin-bottom: 10px;
      color: var(--primary-color);
    }
    .update-changes ul {
      padding-right: 20px;
      margin: 0;
    }
    .update-changes li {
      margin-bottom: 5px;
      color: #555;
    }
    .update-notification-footer {
      display: flex;
      gap: 10px;
      padding: 15px;
    }
    .update-now-btn, .update-later-btn {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Cairo', Arial, sans-serif;
      font-weight: 600;
    }
    .update-now-btn {
      background: var(--primary-color);
      color: white;
    }
    .update-later-btn {
      background: #f1f1f1;
      color: #333;
    }
    
    /* لوحة الإحصائيات المتقدمة */
    .stats-panel {
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      width: 90%;
      max-width: 500px;
      background: var(--card-color);
      box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      transform: translateX(100%);
      transition: transform 0.3s ease;
      overflow-y: auto;
    }
    .stats-panel.show {
      transform: translateX(0);
    }
    .stats-panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }
    .stats-panel-header h3 {
      margin: 0;
      color: var(--primary-color);
    }
    .close-stats-panel {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #888;
    }
    .stats-tabs {
      display: flex;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }
    .stats-tab {
      flex: 1;
      padding: 15px;
      background: none;
      border: none;
      cursor: pointer;
      font-family: 'Cairo', Arial, sans-serif;
      font-weight: 600;
      color: #888;
      transition: all 0.3s ease;
    }
    .stats-tab.active {
      color: var(--primary-color);
      border-bottom: 3px solid var(--primary-color);
    }
    .stats-tab-content {
      padding: 20px;
    }
    .stats-tab-pane {
      display: none;
    }
    .stats-tab-pane.active {
      display: block;
    }
    .chart-container {
      height: 250px;
      position: relative;
      margin-top: 20px;
    }
    
    /* لوحة إعدادات السمة */
    .theme-panel {
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      width: 90%;
      max-width: 400px;
      background: var(--card-color);
      box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      transform: translateX(100%);
      transition: transform 0.3s ease;
      overflow-y: auto;
    }
    .theme-panel.show {
      transform: translateX(0);
    }
    .theme-panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }
    .theme-panel-header h3 {
      margin: 0;
      color: var(--primary-color);
    }
    .close-theme-panel {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #888;
    }
    .theme-options {
      padding: 20px;
    }
    .theme-option {
      margin-bottom: 25px;
    }
    .theme-option label {
      display: block;
      margin-bottom: 10px;
      font-weight: 600;
      color: var(--primary-color);
    }
    .theme-mode-options {
      display: flex;
      gap: 10px;
    }
    .theme-mode-btn {
      flex: 1;
      padding: 10px;
      background: #f1f1f1;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Cairo', Arial, sans-serif;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    .theme-mode-btn.active {
      background: var(--primary-color);
      color: white;
    }
    .color-options {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .color-option {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    .color-option:hover {
      transform: scale(1.1);
    }
    .color-option.active {
      box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.2);
    }
    .font-size-options {
      display: flex;
      gap: 10px;
    }
    .font-size-btn {
      flex: 1;
      padding: 10px;
      background: #f1f1f1;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Cairo', Arial, sans-serif;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    .font-size-btn.active {
      background: var(--primary-color);
      color: white;
    }
    .theme-panel-footer {
      display: flex;
      gap: 10px;
      padding: 20px;
      border-top: 1px solid rgba(0, 0, 0, 0.05);
    }
    .reset-theme-btn, .save-theme-btn {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Cairo', Arial, sans-serif;
      font-weight: 600;
    }
    .reset-theme-btn {
      background: #f1f1f1;
      color: #333;
    }
    .save-theme-btn {
      background: var(--primary-color);
      color: white;
    }
    
    /* نافذة تقدم التحميل */
    .download-progress {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--card-color);
      border-radius: 16px;
      box-shadow: 0 8px 20px var(--shadow-hover-color);
      width: 90%;
      max-width: 400px;
      z-index: 1000;
    }
    .progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }
    .progress-header h3 {
      margin: 0;
      color: var(--primary-color);
      font-size: 1.1rem;
    }
    .close-progress {
      background: none;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
      color: #888;
    }
    .progress-container {
      padding: 20px;
    }
    .progress-bar {
      height: 10px;
      background: #f1f1f1;
      border-radius: 5px;
      overflow: hidden;
      margin-bottom: 10px;
    }
    .progress-fill {
      height: 100%;
      background: var(--primary-color);
      width: 0;
      transition: width 0.3s ease;
    }
    .progress-info {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 0.9rem;
    }
    .progress-status {
      text-align: center;
      color: #888;
      font-size: 0.9rem;
    }
    
    /* الوضع المظلم */
    body.dark-mode {
      --background-color: #121212;
      --card-color: #1e1e1e;
      --text-color: #e0e0e0;
      --shadow-color: rgba(0, 0, 0, 0.3);
      --shadow-hover-color: rgba(0, 0, 0, 0.5);
    }
    body.dark-mode .search-box {
      background: var(--card-color);
      color: var(--text-color);
      border-color: var(--accent-color);
    }
    body.dark-mode .category {
      background: var(--card-color);
      color: var(--text-color);
    }
    body.dark-mode .app-card, body.dark-mode .stat-card {
      background: var(--card-color);
    }
    body.dark-mode .app-name {
      color: var(--accent-color);
    }
    body.dark-mode .app-category {
      color: #90caf9;
    }
    body.dark-mode .rating-value {
      color: #bbb;
    }
    body.dark-mode .theme-toggle, body.dark-mode .quick-access-btn {
      background: var(--card-color);
      color: var(--accent-color);
    }
    body.dark-mode .favorite-btn, body.dark-mode .share-btn {
      background: rgba(30, 30, 30, 0.8);
    }
    body.dark-mode .favorite-btn:hover, body.dark-mode .share-btn:hover {
      background: var(--card-color);
    }
    body.dark-mode .search-suggestions {
      background: var(--card-color);
    }
    body.dark-mode .suggestion-item:hover {
      background-color: rgba(66, 165, 245, 0.2);
    }
    body.dark-mode .review-item {
      background: rgba(255, 255, 255, 0.05);
    }
    body.dark-mode .review-text {
      color: #bbb;
    }
    
    /* Responsive */
    @media (max-width: 600px) {
      h1 {
        font-size: 2rem;
      }
      .app-card {
        width: 100%;
        max-width: 320px;
      }
      .featured-app {
        min-width: 250px;
      }
      .stats-panel, .theme-panel {
        width: 100%;
        max-width: 100%;
      }
      .quick-access-buttons {
        flex-direction: row;
        bottom: 20px;
        top: auto;
        left: 50%;
        transform: translateX(-50%);
      }
    }
    
    /* تأثيرات دوران */
    .spinning {
      animation: spin 1s linear infinite;
    }
  </style>
</head>
<body>
  <button id="theme-toggle" class="theme-toggle" aria-label="تبديل الوضع">
    <i class="fas fa-moon"></i>
  </button>
  
  <div class="quick-access-buttons">
    <button class="quick-access-btn" id="sync-btn" aria-label="مزامنة مع السحابة">
      <i class="fas fa-cloud-upload-alt"></i>
    </button>
    <button class="quick-access-btn" id="stats-btn" aria-label="الإحصائيات">
      <i class="fas fa-chart-bar"></i>
    </button>
    <button class="quick-access-btn" id="theme-settings-btn" aria-label="إعدادات المظهر">
      <i class="fas fa-palette"></i>
    </button>
  </div>
  
  <h1>📱 مكتبة التطبيقات</h1>
  
  <div class="featured-section">
    <h2>🌟 التطبيقات المميزة</h2>
    <div class="featured-container" id="featured-apps"></div>
  </div>
  
  <div class="stats-section">
    <div class="stat-card">
      <div class="stat-number" id="total-apps">0</div>
      <div class="stat-label">إجمالي التطبيقات</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="total-categories">0</div>
      <div class="stat-label">التصنيفات</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="total-downloads">0</div>
      <div class="stat-label">التحميلات</div>
    </div>
  </div>
  
  <div class="search-container">
    <input type="text" class="search-box" id="search" placeholder="ابحث عن تطبيق..." aria-label="بحث عن التطبيقات">
    <span class="search-icon">🔍</span>
    <div class="search-suggestions" id="search-suggestions"></div>
  </div>
  
  <div class="categories" id="categories">
    <div class="category active" data-category="all">الكل</div>
  </div>
  
  <div id="app-list" aria-live="polite" aria-label="قائمة التطبيقات">
    <div class="loader"></div>
  </div>
  
  <!-- لوحة الإحصائيات المتقدمة -->
  <div class="stats-panel" id="stats-panel">
    <div class="stats-panel-header">
      <h3>الإحصائيات</h3>
      <button class="close-stats-panel">&times;</button>
    </div>
    <div class="stats-tabs">
      <button class="stats-tab active" data-tab="general">عامة</button>
      <button class="stats-tab" data-tab="downloads">التحميلات</button>
      <button class="stats-tab" data-tab="categories">التصنيفات</button>
      <button class="stats-tab" data-tab="ratings">التقييمات</button>
    </div>
    <div class="stats-tab-content">
      <div class="stats-tab-pane active" id="general-stats">
        <div class="stat-card">
          <div class="stat-number" id="general-total-apps">0</div>
          <div class="stat-label">إجمالي التطبيقات</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="general-total-categories">0</div>
          <div class="stat-label">التصنيفات</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="general-total-downloads">0</div>
          <div class="stat-label">التحميلات</div>
        </div>
      </div>
      <div class="stats-tab-pane" id="downloads-stats">
        <div class="chart-container">
          <canvas id="downloads-chart"></canvas>
        </div>
      </div>
      <div class="stats-tab-pane" id="categories-stats">
        <div class="chart-container">
          <canvas id="categories-chart"></canvas>
        </div>
      </div>
      <div class="stats-tab-pane" id="ratings-stats">
        <div class="chart-container">
          <canvas id="ratings-chart"></canvas>
        </div>
      </div>
    </div>
  </div>
  
  <!-- لوحة إعدادات السمة -->
  <div class="theme-panel" id="theme-panel">
    <div class="theme-panel-header">
      <h3>إعدادات المظهر</h3>
      <button class="close-theme-panel">&times;</button>
    </div>
    <div class="theme-options">
      <div class="theme-option">
        <label>الوضع</label>
        <div class="theme-mode-options">
          <button class="theme-mode-btn active" data-mode="light">فاتح</button>
          <button class="theme-mode-btn" data-mode="dark">داكن</button>
        </div>
      </div>
      <div class="theme-option">
        <label>اللون الرئيسي</label>
        <div class="color-options">
          <button class="color-option active" data-color="#0d47a1" style="background-color: #0d47a1"></button>
          <button class="color-option" data-color="#7b1fa2" style="background-color: #7b1fa2"></button>
          <button class="color-option" data-color="#388e3c" style="background-color: #388e3c"></button>
          <button class="color-option" data-color="#d32f2f" style="background-color: #d32f2f"></button>
          <button class="color-option" data-color="#f57c00" style="background-color: #f57c00"></button>
        </div>
      </div>
      <div class="theme-option">
        <label>حجم الخط</label>
        <div class="font-size-options">
          <button class="font-size-btn" data-size="small">صغير</button>
          <button class="font-size-btn active" data-size="medium">متوسط</button>
          <button class="font-size-btn" data-size="large">كبير</button>
        </div>
      </div>
    </div>
    <div class="theme-panel-footer">
      <button class="reset-theme-btn">إعادة تعيين</button>
      <button class="save-theme-btn">حفظ</button>
    </div>
  </div>
  
  <script>
    const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQarjS01euTEmqXyvXw8FydmylesAQGJmDd4wt6bueAPywUmaky7znxtiH2TiesQDFCobdG3gbra8wM/pub?gid=0&single=true&output=csv";
    let appsData = [];
    let filteredApps = [];
    let activeCategory = "all";
    
    // نظام الإشعارات المتقدم
    class NotificationSystem {
      constructor() {
        this.container = document.createElement('div');
        this.container.className = 'notifications-container';
        document.body.appendChild(this.container);
      }
      
      show(message, type = 'info', duration = 3000) {
        const notification = document.createElement('div');
        notification.className = `notification notification-${type}`;
        
        // أيقونة حسب النوع
        let icon = '';
        switch(type) {
          case 'success':
            icon = '<i class="fas fa-check-circle"></i>';
            break;
          case 'error':
            icon = '<i class="fas fa-exclamation-circle"></i>';
            break;
          case 'warning':
            icon = '<i class="fas fa-exclamation-triangle"></i>';
            break;
          default:
            icon = '<i class="fas fa-info-circle"></i>';
        }
        
        notification.innerHTML = `
          <div class="notification-icon">${icon}</div>
          <div class="notification-message">${message}</div>
          <button class="notification-close">&times;</button>
        `;
        
        this.container.appendChild(notification);
        
        // إضافة حدث الإغلاق
        notification.querySelector('.notification-close').addEventListener('click', () => {
          this.close(notification);
        });
        
        // إظهار الإشعار
        setTimeout(() => {
          notification.classList.add('show');
        }, 10);
        
        // إغلاق تلقائي
        if (duration > 0) {
          setTimeout(() => {
            this.close(notification);
          }, duration);
        }
        
        return notification;
      }
      
      close(notification) {
        notification.classList.remove('show');
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }
      
      success(message, duration) {
        return this.show(message, 'success', duration);
      }
      
      error(message, duration) {
        return this.show(message, 'error', duration);
      }
      
      warning(message, duration) {
        return this.show(message, 'warning', duration);
      }
      
      info(message, duration) {
        return this.show(message, 'info', duration);
      }
    }
    
    // إنشاء نسخة من نظام الإشعارات
    const notifications = new NotificationSystem();
    
    // إعداد الوضع المظلم المتقدم
    function setupAdvancedThemeSystem() {
      const themeToggle = document.getElementById('theme-toggle');
      const themePanel = document.getElementById('theme-panel');
      const themeSettingsBtn = document.getElementById('theme-settings-btn');
      const closeThemePanel = document.querySelector('.close-theme-panel');
      const saveThemeBtn = document.querySelector('.save-theme-btn');
      const resetThemeBtn = document.querySelector('.reset-theme-btn');
      
      // تحميل إعدادات السمة المحفوظة
      const savedTheme = localStorage.getItem('themeSettings');
      if (savedTheme) {
        const settings = JSON.parse(savedTheme);
        applyThemeSettings(settings);
      }
      
      // تبديل الوضع الفاتح/الداكن
      themeToggle.addEventListener('click', () => {
        document.body.classList.toggle('dark-mode');
        const isDarkMode = document.body.classList.contains('dark-mode');
        
        // تحديث الأيقونة
        themeToggle.innerHTML = isDarkMode ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
        
        // حفظ التفضيل
        const settings = getThemeSettings();
        settings.mode = isDarkMode ? 'dark' : 'light';
        localStorage.setItem('themeSettings', JSON.stringify(settings));
      });
      
      // فتح لوحة إعدادات السمة
      themeSettingsBtn.addEventListener('click', () => {
        themePanel.classList.add('show');
      });
      
      // إغلاق لوحة إعدادات السمة
      closeThemePanel.addEventListener('click', () => {
        themePanel.classList.remove('show');
      });
      
      // حفظ إعدادات السمة
      saveThemeBtn.addEventListener('click', () => {
        const settings = getThemeSettings();
        localStorage.setItem('themeSettings', JSON.stringify(settings));
        notifications.success('تم حفظ إعدادات المظهر');
        themePanel.classList.remove('show');
      });
      
      // إعادة تعيين إعدادات السمة
      resetThemeBtn.addEventListener('click', () => {
        localStorage.removeItem('themeSettings');
        applyThemeSettings({
          mode: 'light',
          primaryColor: '#0d47a1',
          fontSize: 'medium'
        });
        notifications.success('تم إعادة تعيين إعدادات المظهر');
        themePanel.classList.remove('show');
      });
      
      // إعداد أحداث أزرار الوضع
      document.querySelectorAll('.theme-mode-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.theme-mode-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
        });
      });
      
      // إعداد أحداث ألوان السمة
      document.querySelectorAll('.color-option').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.color-option').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
        });
      });
      
      // إعداد أحداث حجم الخط
      document.querySelectorAll('.font-size-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.font-size-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
        });
      });
    }
    
    // تطبيق إعدادات السمة
    function applyThemeSettings(settings) {
      // تطبيق الوضع
      if (settings.mode === 'dark') {
        document.body.classList.add('dark-mode');
        document.getElementById('theme-toggle').innerHTML = '<i class="fas fa-sun"></i>';
      } else {
        document.body.classList.remove('dark-mode');
        document.getElementById('theme-toggle').innerHTML = '<i class="fas fa-moon"></i>';
      }
      
      // تطبيق اللون الرئيسي
      if (settings.primaryColor) {
        document.documentElement.style.setProperty('--primary-color', settings.primaryColor);
      }
      
      // تطبيق حجم الخط
      if (settings.fontSize) {
        let fontSize = '16px';
        switch(settings.fontSize) {
          case 'small':
            fontSize = '14px';
            break;
          case 'large':
            fontSize = '18px';
            break;
          default:
            fontSize = '16px';
        }
        document.documentElement.style.setProperty('--font-size-base', fontSize);
      }
      
      // تحديث واجهة المستخدم
      updateThemeUI(settings);
    }
    
    // تحديث واجهة المستخدم للسمة
    function updateThemeUI(settings) {
      // تحديث أزرار الوضع
      document.querySelectorAll('.theme-mode-btn').forEach(btn => {
        btn.classList.toggle('active', btn.getAttribute('data-mode') === settings.mode);
      });
      
      // تحديث ألوان السمة
      document.querySelectorAll('.color-option').forEach(btn => {
        btn.classList.toggle('active', btn.getAttribute('data-color') === settings.primaryColor);
      });
      
      // تحديث حجم الخط
      document.querySelectorAll('.font-size-btn').forEach(btn => {
        btn.classList.toggle('active', btn.getAttribute('data-size') === settings.fontSize);
      });
    }
    
    // الحصول على إعدادات السمة الحالية
    function getThemeSettings() {
      const mode = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
      const primaryColor = document.querySelector('.color-option.active')?.getAttribute('data-color') || '#0d47a1';
      const fontSize = document.querySelector('.font-size-btn.active')?.getAttribute('data-size') || 'medium';
      
      return {
        mode,
        primaryColor,
        fontSize
      };
    }
    
    // نظام البحث المتقدم مع الاقتراحات
    function setupAdvancedSearch() {
      const searchBox = document.getElementById('search');
      const searchSuggestions = document.getElementById('search-suggestions');
      
      // إضافة اقتراحات البحث
      searchBox.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase().trim();
        
        if (searchTerm.length > 1) {
          showSearchSuggestions(searchTerm);
        } else {
          hideSearchSuggestions();
        }
      });
      
      // إغلاق الاقتراحات عند النقر خارجها
      document.addEventListener('click', function(e) {
        if (!e.target.closest('.search-container')) {
          hideSearchSuggestions();
        }
      });
    }
    
    // عرض اقتراحات البحث
    function showSearchSuggestions(searchTerm) {
      const searchSuggestions = document.getElementById('search-suggestions');
      
      // البحث عن تطبيقات تطابق مصطلح البحث
      const suggestions = appsData.filter(app => 
        app.name.toLowerCase().includes(searchTerm) || 
        app.category.toLowerCase().includes(searchTerm)
      ).slice(0, 5); // عرض 5 اقتراحات كحد أقصى
      
      // عرض الاقتراحات
      searchSuggestions.innerHTML = '';
      
      if (suggestions.length > 0) {
        suggestions.forEach(app => {
          const suggestionItem = document.createElement('div');
          suggestionItem.className = 'suggestion-item';
          suggestionItem.textContent = app.name;
          
          suggestionItem.addEventListener('click', function() {
            document.getElementById('search').value = app.name;
            handleSearch({ target: { value: app.name } });
            hideSearchSuggestions();
          });
          
          searchSuggestions.appendChild(suggestionItem);
        });
      } else {
        searchSuggestions.innerHTML = '<div class="no-suggestions">لا توجد نتائج</div>';
      }
      
      searchSuggestions.classList.add('show');
    }
    
    // إخفاء اقتراحات البحث
    function hideSearchSuggestions() {
      const searchSuggestions = document.getElementById('search-suggestions');
      if (searchSuggestions) {
        searchSuggestions.classList.remove('show');
      }
    }
    
    // نظام المزامنة مع السحابة
    function setupCloudSync() {
      const syncBtn = document.getElementById('sync-btn');
      
      syncBtn.addEventListener('click', syncWithCloud);
      
      // المزامنة التلقائية كل 30 دقيقة
      setInterval(syncWithCloud, 30 * 60 * 1000);
    }
    
    // المزامنة مع السحابة
    async function syncWithCloud() {
      const syncBtn = document.getElementById('sync-btn');
      syncBtn.classList.add('spinning');
      
      try {
        // جمع البيانات للمزامنة
        const dataToSync = {
          favorites: JSON.parse(localStorage.getItem('favorites') || '[]'),
          downloads: JSON.parse(localStorage.getItem('downloads') || '{}'),
          reviews: JSON.parse(localStorage.getItem('reviews') || '{}'),
          themeSettings: JSON.parse(localStorage.getItem('themeSettings') || '{}'),
          lastSync: new Date().toISOString()
        };
        
        // في تطبيق حقيقي، سيتم إرسال البيانات إلى الخادم
        // هنا نقوم بمحاكاة العملية
        await new Promise(resolve => setTimeout(resolve, 2000));
        
        // حفظ وقت آخر مزامنة
        localStorage.setItem('lastSync', dataToSync.lastSync);
        
        notifications.success('تمت المزامنة بنجاح');
      } catch (error) {
        notifications.error('فشلت المزامنة');
      } finally {
        syncBtn.classList.remove('spinning');
      }
    }
    
    // نظام الإحصائيات المتقدم
    function setupAdvancedStats() {
      const statsBtn = document.getElementById('stats-btn');
      const statsPanel = document.getElementById('stats-panel');
      const closeStatsPanel = document.querySelector('.close-stats-panel');
      
      // فتح لوحة الإحصائيات
      statsBtn.addEventListener('click', function() {
        statsPanel.classList.add('show');
        renderCharts();
      });
      
      // إغلاق لوحة الإحصائيات
      closeStatsPanel.addEventListener('click', function() {
        statsPanel.classList.remove('show');
      });
      
      // إعداد أحداث تبويبات الإحصائيات
      document.querySelectorAll('.stats-tab').forEach(tab => {
        tab.addEventListener('click', function() {
          // تحديث التبويب النشط
          document.querySelectorAll('.stats-tab').forEach(t => t.classList.remove('active'));
          this.classList.add('active');
          
          // تحديث المحتوى النشط
          const tabId = this.getAttribute('data-tab');
          document.querySelectorAll('.stats-tab-pane').forEach(pane => {
            pane.classList.remove('active');
          });
          document.getElementById(`${tabId}-stats`).classList.add('active');
        });
      });
    }
    
    // عرض الرسوم البيانية
    function renderCharts() {
      // تحديث الإحصائيات العامة
      document.getElementById('general-total-apps').textContent = appsData.length;
      document.getElementById('general-total-categories').textContent = [...new Set(appsData.map(app => app.category))].length;
      document.getElementById('general-total-downloads').textContent = (appsData.length * 1250).toLocaleString('ar-EG');
      
      // في تطبيق حقيقي، سيتم استخدام مكتبة مثل Chart.js
      // هنا نقوم بمحاكاة الرسوم البيانية
      
      // رسم بياني للتحميلات
      renderDownloadsChart();
      
      // رسم بياني للتصنيفات
      renderCategoriesChart();
      
      // رسم بياني للتقييمات
      renderRatingsChart();
    }
    
    // رسم بياني للتحميلات
    function renderDownloadsChart() {
      const canvas = document.getElementById('downloads-chart');
      if (!canvas) return;
      
      const ctx = canvas.getContext('2d');
      const width = canvas.parentElement.offsetWidth;
      const height = 250;
      
      canvas.width = width;
      canvas.height = height;
      
      // مسح الرسم البياني السابق
      ctx.clearRect(0, 0, width, height);
      
      // إنشاء بيانات وهمية
      const days = ['الأحد', 'الاثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'];
      const data = days.map(() => Math.floor(Math.random() * 100) + 50);
      
      // إعدادات الرسم البياني
      const padding = 40;
      const chartWidth = width - padding * 2;
      const chartHeight = height - padding * 2;
      const barWidth = chartWidth / days.length;
      const maxValue = Math.max(...data);
      
      // رسم المحاور
      ctx.beginPath();
      ctx.moveTo(padding, padding);
      ctx.lineTo(padding, height - padding);
      ctx.lineTo(width - padding, height - padding);
      ctx.strokeStyle = '#ddd';
      ctx.stroke();
      
      // رسم الأعمدة
      data.forEach((value, i) => {
        const barHeight = (value / maxValue) * chartHeight;
        const x = padding + i * barWidth + barWidth * 0.2;
        const y = height - padding - barHeight;
        
        ctx.fillStyle = '#0d47a1';
        ctx.fillRect(x, y, barWidth * 0.6, barHeight);
        
        // كتابة القيمة
        ctx.fillStyle = '#333';
        ctx.font = '12px Cairo';
        ctx.textAlign = 'center';
        ctx.fillText(value, x + barWidth * 0.3, y - 5);
        
        // كتابة اليوم
        ctx.fillText(days[i], x + barWidth * 0.3, height - padding + 20);
      });
    }
    
    // رسم بياني للتصنيفات
    function renderCategoriesChart() {
      const canvas = document.getElementById('categories-chart');
      if (!canvas) return;
      
      const ctx = canvas.getContext('2d');
      const width = canvas.parentElement.offsetWidth;
      const height = 250;
      
      canvas.width = width;
      canvas.height = height;
      
      // مسح الرسم البياني السابق
      ctx.clearRect(0, 0, width, height);
      
      // تجميع التطبيقات حسب التصنيف
      const categories = {};
      appsData.forEach(app => {
        if (!categories[app.category]) {
          categories[app.category] = 0;
        }
        categories[app.category]++;
      });
      
      const categoryNames = Object.keys(categories);
      const categoryData = Object.values(categories);
      
      // إعدادات الرسم البياني
      const centerX = width / 2;
      const centerY = height / 2;
      const radius = Math.min(width, height) * 0.3;
      const total = categoryData.reduce((sum, value) => sum + value, 0);
      
      // رسم الدائرة
      let startAngle = 0;
      const colors = ['#0d47a1', '#1976d2', '#42a5f5', '#64b5f6', '#90caf9'];
      
      categoryData.forEach((value, i) => {
        const sliceAngle = (value / total) * 2 * Math.PI;
        
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.arc(centerX, centerY, radius, startAngle, startAngle + sliceAngle);
        ctx.closePath();
        
        ctx.fillStyle = colors[i % colors.length];
        ctx.fill();
        
        // كتابة التصنيف
        const textAngle = startAngle + sliceAngle / 2;
        const textX = centerX + Math.cos(textAngle) * (radius * 0.7);
        const textY = centerY + Math.sin(textAngle) * (radius * 0.7);
        
        ctx.fillStyle = '#fff';
        ctx.font = 'bold 12px Cairo';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(categoryNames[i], textX, textY);
        
        startAngle += sliceAngle;
      });
    }
    
    // رسم بياني للتقييمات
    function renderRatingsChart() {
      const canvas = document.getElementById('ratings-chart');
      if (!canvas) return;
      
      const ctx = canvas.getContext('2d');
      const width = canvas.parentElement.offsetWidth;
      const height = 250;
      
      canvas.width = width;
      canvas.height = height;
      
      // مسح الرسم البياني السابق
      ctx.clearRect(0, 0, width, height);
      
      // إنشاء بيانات وهمية
      const ratings = [1, 2, 3, 4, 5];
      const data = ratings.map(rating => {
        return appsData.filter(app => Math.floor(app.rating) === rating).length;
      });
      
      // إعدادات الرسم البياني
      const padding = 40;
      const chartWidth = width - padding * 2;
      const chartHeight = height - padding * 2;
      const barWidth = chartWidth / ratings.length;
      const maxValue = Math.max(...data);
      
      // رسم المحاور
      ctx.beginPath();
      ctx.moveTo(padding, padding);
      ctx.lineTo(padding, height - padding);
      ctx.lineTo(width - padding, height - padding);
      ctx.strokeStyle = '#ddd';
      ctx.stroke();
      
      // رسم الأعمدة
      data.forEach((value, i) => {
        const barHeight = (value / maxValue) * chartHeight;
        const x = padding + i * barWidth + barWidth * 0.2;
        const y = height - padding - barHeight;
        
        ctx.fillStyle = '#ffc107';
        ctx.fillRect(x, y, barWidth * 0.6, barHeight);
        
        // كتابة القيمة
        ctx.fillStyle = '#333';
        ctx.font = '12px Cairo';
        ctx.textAlign = 'center';
        ctx.fillText(value, x + barWidth * 0.3, y - 5);
        
        // كتابة التقييم
        ctx.fillText(`${ratings[i]} ★`, x + barWidth * 0.3, height - padding + 20);
      });
    }
    
    // نظام المراجعات والتعليقات
    function setupReviewSystem() {
      document.querySelectorAll('.add-review-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const appCard = this.closest('.app-card');
          const appName = appCard.querySelector('.app-name').textContent;
          
          // إنشاء نموذج المراجعة
          const reviewFormModal = document.createElement('div');
          reviewFormModal.className = 'modal-overlay';
          reviewFormModal.innerHTML = `
            <div class="modal-content">
              <div class="modal-header">
                <h3>إضافة مراجعة لتطبيق ${appName}</h3>
                <button class="close-modal">&times;</button>
              </div>
              <div class="rating-input">
                <span>التقييم:</span>
                <div class="star-rating">
                  <span class="star" data-rating="1">★</span>
                  <span class="star" data-rating="2">★</span>
                  <span class="star" data-rating="3">★</span>
                  <span class="star" data-rating="4">★</span>
                  <span class="star" data-rating="5">★</span>
                </div>
              </div>
              <textarea placeholder="اكتب مراجعتك هنا..."></textarea>
              <div class="form-buttons">
                <button class="submit-review">إرسال</button>
                <button class="cancel-review">إلغاء</button>
              </div>
            </div>
          `;
          
          document.body.appendChild(reviewFormModal);
          
          // إظهار النموذج
          setTimeout(() => {
            reviewFormModal.classList.add('show');
          }, 10);
          
          // إعداد أحداث النموذج
          let selectedRating = 0;
          reviewFormModal.querySelectorAll('.star').forEach(star => {
            star.addEventListener('click', function() {
              selectedRating = parseInt(this.getAttribute('data-rating'));
              updateStarDisplay(reviewFormModal, selectedRating);
            });
          });
          
          reviewFormModal.querySelector('.submit-review').addEventListener('click', function() {
            const reviewText = reviewFormModal.querySelector('textarea').value.trim();
            
            if (selectedRating === 0) {
              notifications.warning('الرجاء اختيار تقييم');
              return;
            }
            
            if (reviewText === '') {
              notifications.warning('الرجاء كتابة مراجعة');
              return;
            }
            
            // حفظ المراجعة
            const reviews = JSON.parse(localStorage.getItem('reviews') || '{}');
            
            if (!reviews[appName]) {
              reviews[appName] = [];
            }
            
            reviews[appName].push({
              author: 'مستخدم', // في تطبيق حقيقي، سيتم استخدام اسم المستخدم المسجل
              rating: selectedRating,
              text: reviewText,
              date: new Date().toISOString()
            });
            
            localStorage.setItem('reviews', JSON.stringify(reviews));
            
            // إغلاق النموذج
            reviewFormModal.classList.remove('show');
            setTimeout(() => {
              document.body.removeChild(reviewFormModal);
            }, 300);
            
            // تحديث متوسط التقييم
            updateAppRating(appName);
            
            // إعادة عرض المراجعات
            displayAppReviews(appName, appCard.querySelector('.reviews-list'));
            
            notifications.success('تم إضافة مراجعتك بنجاح');
          });
          
          reviewFormModal.querySelector('.cancel-review').addEventListener('click', function() {
            reviewFormModal.classList.remove('show');
            setTimeout(() => {
              document.body.removeChild(reviewFormModal);
            }, 300);
          });
          
          reviewFormModal.querySelector('.close-modal').addEventListener('click', function() {
            reviewFormModal.classList.remove('show');
            setTimeout(() => {
              document.body.removeChild(reviewFormModal);
            }, 300);
          });
        });
      });
    }
    
    // تحديث عرض النجوم
    function updateStarDisplay(container, rating) {
      container.querySelectorAll('.star').forEach((star, index) => {
        if (index < rating) {
          star.classList.add('active');
        } else {
          star.classList.remove('active');
        }
      });
    }
    
    // تحديث تقييم التطبيق
    function updateAppRating(appName) {
      const reviews = JSON.parse(localStorage.getItem('reviews') || '{}');
      const appReviews = reviews[appName] || [];
      
      if (appReviews.length === 0) return;
      
      // حساب متوسط التقييم
      const totalRating = appReviews.reduce((sum, review) => sum + review.rating, 0);
      const averageRating = (totalRating / appReviews.length).toFixed(1);
      
      // تحديث التقييم في بيانات التطبيق
      const appIndex = appsData.findIndex(app => app.name === appName);
      if (appIndex !== -1) {
        appsData[appIndex].rating = parseFloat(averageRating);
      }
      
      // تحديث واجهة المستخدم إذا كان التطبيق معروضًا
      const appCards = document.querySelectorAll('.app-card');
      appCards.forEach(card => {
        const cardAppName = card.querySelector('.app-name').textContent;
        if (cardAppName === appName) {
          // تحديث النجوم
          const fullStars = Math.floor(averageRating);
          const halfStar = averageRating % 1 >= 0.5 ? 1 : 0;
          const emptyStars = 5 - fullStars - halfStar;
          
          let starsHtml = '';
          for (let i = 0; i < fullStars; i++) {
            starsHtml += '★';
          }
          if (halfStar) {
            starsHtml += '☆';
          }
          for (let i = 0; i < emptyStars; i++) {
            starsHtml += '☆';
          }
          
          card.querySelector('.stars').textContent = starsHtml;
          card.querySelector('.rating-value').textContent = averageRating;
        }
      });
    }
    
    // عرض مراجعات التطبيق
    function displayAppReviews(appName, container) {
      const reviews = JSON.parse(localStorage.getItem('reviews') || '{}');
      const appReviews = reviews[appName] || [];
      
      container.innerHTML = '';
      
      if (appReviews.length === 0) {
        container.innerHTML = '<div style="text-align: center; color: #888; font-size: 0.8rem;">لا توجد مراجعات بعد</div>';
        return;
      }
      
      // عرض أحدث 3 مراجعات
      appReviews.slice(-3).reverse().forEach(review => {
        const reviewItem = document.createElement('div');
        reviewItem.className = 'review-item';
        
        // إنشاء نجوم التقييم
        let starsHtml = '';
        for (let i = 0; i < review.rating; i++) {
          starsHtml += '★';
        }
        for (let i = review.rating; i < 5; i++) {
          starsHtml += '☆';
        }
        
        reviewItem.innerHTML = `
          <div class="review-header">
            <div class="review-author">${review.author}</div>
            <div class="review-rating">${starsHtml}</div>
          </div>
          <div class="review-text">${review.text}</div>
        `;
        
        container.appendChild(reviewItem);
      });
    }
    
    // نظام التحديثات التلقائي
    function setupUpdateSystem() {
      // التحقق من التحديثات عند تحميل الصفحة
      setTimeout(checkForUpdates, 5000);
    }
    
    // التحقق من وجود تحديثات
    async function checkForUpdates() {
      try {
        // محاكاة التحقق من التحديثات
        await new Promise(resolve => setTimeout(resolve, 2000));
        
        // في تطبيق حقيقي، سيتم جلب بيانات التحديثات من الخادم
        // هنا نقوم بمحاكاة وجود تحديثات بنسبة 30%
        const updatesAvailable = Math.random() > 0.7;
        
        if (updatesAvailable) {
          // اختيار تطبيق عشوائي للتحديث
          const randomApp = appsData[Math.floor(Math.random() * appsData.length)];
          
          showUpdateNotification(randomApp);
        }
      } catch (error) {
        console.error('فشل التحقق من التحديثات:', error);
      }
    }
    
    // عرض إشعار التحديث
    function showUpdateNotification(app) {
      const updateNotification = document.createElement('div');
      updateNotification.className = 'update-notification';
      updateNotification.innerHTML = `
        <div class="update-notification-header">
          <div class="update-icon">
            <i class="fas fa-download"></i>
          </div>
          <div class="update-title">تحديث متاح</div>
          <button class="close-update-notification">&times;</button>
        </div>
        <div class="update-notification-content">
          <div class="update-app-info">
            <img src="${app.image}" alt="${app.name}" class="update-app-icon">
            <div class="update-app-details">
              <div class="update-app-name">${app.name}</div>
              <div class="update-app-version">الإصدار 2.0.1</div>
            </div>
          </div>
          <div class="update-changes">
            <h4>ما الجديد:</h4>
            <ul>
              <li>إصلاح بعض الأخطاء</li>
              <li>تحسين الأداء</li>
              <li>ميزات جديدة</li>
            </ul>
          </div>
        </div>
        <div class="update-notification-footer">
          <button class="update-now-btn">تحديث الآن</button>
          <button class="update-later-btn">لاحقًا</button>
        </div>
      `;
      
      document.body.appendChild(updateNotification);
      
      // إظهار الإشعار
      setTimeout(() => {
        updateNotification.classList.add('show');
      }, 10);
      
      // إعداد الأحداث
      updateNotification.querySelector('.close-update-notification').addEventListener('click', () => {
        updateNotification.classList.remove('show');
        setTimeout(() => {
          document.body.removeChild(updateNotification);
        }, 300);
      });
      
      updateNotification.querySelector('.update-later-btn').addEventListener('click', () => {
        updateNotification.classList.remove('show');
        setTimeout(() => {
          document.body.removeChild(updateNotification);
        }, 300);
      });
      
      updateNotification.querySelector('.update-now-btn').addEventListener('click', () => {
        updateNotification.classList.remove('show');
        setTimeout(() => {
          document.body.removeChild(updateNotification);
        }, 300);
        
        notifications.info(`جاري تحديث ${app.name}...`);
        
        setTimeout(() => {
          notifications.success(`تم تحديث ${app.name} بنجاح`);
        }, 3000);
      });
    }
    
    // نظام التحميل المتقدم
    function setupAdvancedDownload() {
      document.querySelectorAll('.download').forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          
          const appCard = this.closest('.app-card');
          const appName = appCard.querySelector('.app-name').textContent;
          const fileUrl = this.getAttribute('href');
          const fileName = this.getAttribute('download');
          
          // إنشاء نافذة تقدم التحميل
          const progressWindow = document.createElement('div');
          progressWindow.className = 'download-progress';
          progressWindow.innerHTML = `
            <div class="progress-header">
              <h3>جاري تحميل ${appName}</h3>
              <button class="close-progress">&times;</button>
            </div>
            <div class="progress-container">
              <div class="progress-bar">
                <div class="progress-fill"></div>
              </div>
              <div class="progress-info">
                <span class="progress-percent">0%</span>
                <span class="progress-size">0 MB / 0 MB</span>
              </div>
            </div>
            <div class="progress-status">يبدأ التحميل...</div>
          `;
          
          document.body.appendChild(progressWindow);
          
          // إغلاق نافذة التقدم
          progressWindow.querySelector('.close-progress').addEventListener('click', function() {
            progressWindow.remove();
          });
          
          // محاكاة تقدم التحميل
          simulateDownload(progressWindow, fileUrl, fileName, appName);
        });
      });
    }
    
    // محاكاة عملية التحميل
    function simulateDownload(progressWindow, fileUrl, fileName, appName) {
      const progressFill = progressWindow.querySelector('.progress-fill');
      const progressPercent = progressWindow.querySelector('.progress-percent');
      const progressSize = progressWindow.querySelector('.progress-size');
      const progressStatus = progressWindow.querySelector('.progress-status');
      
      // حجم الملف الوهمي (للعرض فقط)
      const totalSize = Math.floor(Math.random() * 50) + 10; // بين 10 و 60 ميجابايت
      let downloadedSize = 0;
      
      const interval = setInterval(() => {
        // زيادة حجم التحميل بشكل عشوائي
        const increment = Math.floor(Math.random() * 5) + 1;
        downloadedSize += increment;
        
        if (downloadedSize > totalSize) {
          downloadedSize = totalSize;
        }
        
        // حساب النسبة المئوية
        const percent = Math.floor((downloadedSize / totalSize) * 100);
        
        // تحديث واجهة المستخدم
        progressFill.style.width = `${percent}%`;
        progressPercent.textContent = `${percent}%`;
        progressSize.textContent = `${downloadedSize} MB / ${totalSize} MB`;
        
        // تحديث الحالة
        if (percent < 25) {
          progressStatus.textContent = 'يبدأ التحميل...';
        } else if (percent < 50) {
          progressStatus.textContent = 'جاري التحميل...';
        } else if (percent < 75) {
          progressStatus.textContent = 'استمر في التحميل...';
        } else if (percent < 100) {
          progressStatus.textContent = 'قريب من الانتهاء...';
        } else {
          progressStatus.textContent = 'اكتمل التحميل!';
          
          // إيقاف المؤقت
          clearInterval(interval);
          
          // بدء التحميل الفعلي
          const a = document.createElement('a');
          a.href = fileUrl;
          a.download = fileName;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          
          // حفظ التحميل في السجلات
          saveDownloadRecord(appName);
          
          // إغلاق النافذة بعد ثانيتين
          setTimeout(() => {
            progressWindow.remove();
            notifications.success(`تم تحميل ${appName} بنجاح`);
          }, 2000);
        }
      }, 200);
    }
    
    // حفظ سجل التحميل
    function saveDownloadRecord(appName) {
      const downloads = JSON.parse(localStorage.getItem('downloads') || '{}');
      downloads[appName] = (downloads[appName] || 0) + 1;
      localStorage.setItem('downloads', JSON.stringify(downloads));
      
      // تحديث الإحصائيات
      const totalDownloadsElement = document.getElementById('total-downloads');
      if (totalDownloadsElement) {
        const currentTotal = parseInt(totalDownloadsElement.textContent.replace(/,/g, ''));
        totalDownloadsElement.textContent = (currentTotal + 1).toLocaleString('ar-EG');
      }
    }
    
    // تحميل التطبيقات من Google Sheets
    async function loadApps() {
      try {
        const response = await fetch(sheetURL);
        if (!response.ok) throw new Error("فشل تحميل البيانات");
        
        const data = await response.text();
        const rows = parseCSV(data);
        
        if (rows.length < 2) throw new Error("لا توجد بيانات كافية");
        
        const headers = rows[0];
        appsData = [];
        
        for (let i = 1; i < rows.length; i++) {
          const row = rows[i];
          if (row.length < 6) continue; // الآن نتوقع 6 أعمدة (بما في ذلك التقييم)
          
          const [name, file, fileName, image, category, rating] = row;
          appsData.push({
            name: name.trim(),
            file: file.trim(),
            fileName: fileName.trim(),
            image: image.trim(),
            category: category.trim() || "غير مصنف",
            rating: parseFloat(rating.trim()) || (Math.random() * 2 + 3).toFixed(1) // تقييم عشوائي إذا لم يكن موجودًا
          });
        }
        
        // استخراج التصنيفات الفريدة
        const categories = [...new Set(appsData.map(app => app.category))];
        renderCategories(categories);
        
        // عرض التطبيقات المميزة
        renderFeaturedApps();
        
        // تحديث الإحصائيات
        updateStats();
        
        // عرض التطبيقات
        filteredApps = [...appsData];
        renderApps();
        
        // إضافة مستمعات الأحداث
        setupEventListeners();
        
        // إعداد الأنظمة الإضافية
        setupAdvancedSearch();
        setupCloudSync();
        setupAdvancedStats();
        setupUpdateSystem();
        setupAdvancedDownload();
        
      } catch (error) {
        console.error(error);
        document.getElementById("app-list").innerHTML = "<p>حدث خطأ أثناء تحميل التطبيقات. الرجاء المحاولة لاحقًا.</p>";
      }
    }
    
    // دالة لتحليل CSV بشكل أفضل
    function parseCSV(csvText) {
      const lines = csvText.trim().split('\n');
      const result = [];
      
      for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        const row = [];
        let insideQuotes = false;
        let currentValue = '';
        
        for (let j = 0; j < line.length; j++) {
          const char = line[j];
          
          if (char === '"') {
            insideQuotes = !insideQuotes;
          } else if (char === ',' && !insideQuotes) {
            row.push(currentValue);
            currentValue = '';
          } else {
            currentValue += char;
          }
        }
        
        row.push(currentValue);
        result.push(row);
      }
      
      return result;
    }
    
    // عرض التطبيقات المميزة
    function renderFeaturedApps() {
      const featuredContainer = document.getElementById('featured-apps');
      if (!featuredContainer) return;
      
      // اختيار 3 تطبيقات عشوائية كتطبيقات مميزة
      const featuredApps = [...appsData].sort(() => 0.5 - Math.random()).slice(0, 3);
      
      featuredContainer.innerHTML = '';
      
      featuredApps.forEach(app => {
        const card = document.createElement('div');
        card.className = 'featured-app';
        card.innerHTML = `
          <img src="${app.image}" alt="شعار التطبيق ${app.name}" loading="lazy" />
          <div class="app-name">${app.name}</div>
          <div class="app-category">${app.category}</div>
          <a class="download" href="${app.file}" download="${app.fileName}" aria-label="تحميل التطبيق ${app.name}">⬇️ تحميل</a>
        `;
        featuredContainer.appendChild(card);
      });
    }
    
    // تحديث الإحصائيات
    function updateStats() {
      // إجمالي التطبيقات
      document.getElementById('total-apps').textContent = appsData.length;
      
      // إجمالي التصنيفات
      const categories = [...new Set(appsData.map(app => app.category))];
      document.getElementById('total-categories').textContent = categories.length;
      
      // إجمالي التحميلات (قيمة وهمية للعرض)
      document.getElementById('total-downloads').textContent = 
        (appsData.length * 1250).toLocaleString('ar-EG');
    }
    
    // عرض التصنيفات
    function renderCategories(categories) {
      const categoriesContainer = document.getElementById("categories");
      categoriesContainer.innerHTML = '<div class="category active" data-category="all">الكل</div>';
      
      categories.forEach(category => {
        const categoryElement = document.createElement("div");
        categoryElement.className = "category";
        categoryElement.setAttribute("data-category", category);
        categoryElement.textContent = category;
        categoriesContainer.appendChild(categoryElement);
      });
    }
    
    // عرض التطبيقات
    function renderApps() {
      const appList = document.getElementById("app-list");
      
      if (filteredApps.length === 0) {
        appList.innerHTML = '<div class="no-results">لم يتم العثور على تطبيقات تطابق بحثك</div>';
        return;
      }
      
      appList.innerHTML = "";
      
      filteredApps.forEach(app => {
        const card = document.createElement("div");
        card.className = "app-card";
        
        // إنشاء نجوم التقييم
        const fullStars = Math.floor(app.rating);
        const halfStar = app.rating % 1 >= 0.5 ? 1 : 0;
        const emptyStars = 5 - fullStars - halfStar;
        
        let starsHtml = '';
        for (let i = 0; i < fullStars; i++) {
          starsHtml += '★';
        }
        if (halfStar) {
          starsHtml += '☆';
        }
        for (let i = 0; i < emptyStars; i++) {
          starsHtml += '☆';
        }
        
        card.innerHTML = `
          <button class="favorite-btn" aria-label="إضافة للمفضلة">
            <span class="favorite-icon">♡</span>
          </button>
          <img src="${app.image}" alt="شعار التطبيق ${app.name}" loading="lazy" />
          <div class="app-name">${app.name}</div>
          <div class="app-category">${app.category}</div>
          <div class="app-rating">
            <span class="stars">${starsHtml}</span>
            <span class="rating-value">${app.rating}</span>
          </div>
          <a class="download" href="${app.file}" download="${app.fileName}" aria-label="تحميل التطبيق ${app.name}">⬇️ تحميل</a>
          <button class="share-btn" aria-label="مشاركة التطبيق">
            <i class="fas fa-share-alt"></i>
          </button>
          <div class="reviews-section">
            <button class="add-review-btn">إضافة مراجعة</button>
            <div class="reviews-list"></div>
          </div>
        `;
        appList.appendChild(card);
        
        // عرض مراجعات التطبيق
        displayAppReviews(app.name, card.querySelector('.reviews-list'));
      });
      
      // إعداد أزرار المفضلة والمشاركة
      setupFavoriteButtons();
      setupShareButtons();
      setupReviewSystem();
      setupAdvancedDownload();
    }
    
    // إعداد أزرار المفضلة
    function setupFavoriteButtons() {
      document.querySelectorAll('.favorite-btn').forEach(btn => {
        // التحقق مما إذا كان التطبيق في المفضلة
        const appName = btn.closest('.app-card').querySelector('.app-name').textContent;
        const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
        if (favorites.includes(appName)) {
          btn.classList.add('active');
        }
        
        btn.addEventListener('click', function(e) {
          e.stopPropagation();
          this.classList.toggle('active');
          const appName = this.closest('.app-card').querySelector('.app-name').textContent;
          
          // حفظ المفضلة في localStorage
          let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
          if (this.classList.contains('active')) {
            if (!favorites.includes(appName)) {
              favorites.push(appName);
              notifications.success(`تمت إضافة ${appName} إلى المفضلة`);
            }
          } else {
            favorites = favorites.filter(fav => fav !== appName);
            notifications.warning(`تمت إزالة ${appName} من المفضلة`);
          }
          localStorage.setItem('favorites', JSON.stringify(favorites));
        });
      });
    }
    
    // إعداد أزرار المشاركة
    function setupShareButtons() {
      document.querySelectorAll('.share-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.stopPropagation();
          const appCard = this.closest('.app-card');
          const appName = appCard.querySelector('.app-name').textContent;
          const appUrl = window.location.href;
          
          // التحقق من دعم Web Share API
          if (navigator.share) {
            navigator.share({
              title: appName,
              text: `تحقق من تطبيق ${appName} في مكتبة التطبيقات`,
              url: appUrl
            })
            .then(() => notifications.success(`تمت مشاركة ${appName} بنجاح`))
            .catch(err => console.log('خطأ في المشاركة:', err));
          } else {
            // بديل للمتصفحات التي لا تدعم Web Share API
            const shareUrl = `https://api.whatsapp.com/send?text=${encodeURIComponent(`تحقق من تطبيق ${appName}: ${appUrl}`)}`;
            window.open(shareUrl, '_blank');
          }
        });
      });
    }
    
    // إعداد مستمعي الأحداث
    function setupEventListeners() {
      // البحث
      const searchBox = document.getElementById("search");
      searchBox.addEventListener("input", handleSearch);
      
      // التصنيفات
      const categoriesContainer = document.getElementById("categories");
      categoriesContainer.addEventListener("click", handleCategoryClick);
    }
    
    // معالجة البحث
    function handleSearch(e) {
      const searchTerm = e.target.value.toLowerCase().trim();
      
      if (searchTerm === "") {
        filterByCategory(activeCategory);
        return;
      }
      
      filteredApps = appsData.filter(app => 
        app.name.toLowerCase().includes(searchTerm) || 
        app.category.toLowerCase().includes(searchTerm)
      );
      
      renderApps();
    }
    
    // معالجة النقر على التصنيفات
    function handleCategoryClick(e) {
      if (!e.target.classList.contains("category")) return;
      
      // تحديث التصنيف النشط
      document.querySelectorAll(".category").forEach(cat => {
        cat.classList.remove("active");
      });
      e.target.classList.add("active");
      
      // تصفية التطبيقات حسب التصنيف
      const category = e.target.getAttribute("data-category");
      activeCategory = category;
      filterByCategory(category);
    }
    
    // تصفية التطبيقات حسب التصنيف
    function filterByCategory(category) {
      if (category === "all") {
        filteredApps = [...appsData];
      } else {
        filteredApps = appsData.filter(app => app.category === category);
      }
      
      // إعادة تطبيق البحث إذا كان هناك نص في مربع البحث
      const searchTerm = document.getElementById("search").value.toLowerCase().trim();
      if (searchTerm !== "") {
        filteredApps = filteredApps.filter(app => 
          app.name.toLowerCase().includes(searchTerm) || 
          app.category.toLowerCase().includes(searchTerm)
        );
      }
      
      renderApps();
    }
    
    // تحميل التطبيقات عند تحميل الصفحة
    document.addEventListener('DOMContentLoaded', () => {
      setupAdvancedThemeSystem();
      loadApps();
    });
  </script>
</body>
</html>
